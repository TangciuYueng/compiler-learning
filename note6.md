[TOC]
# 属性文法和语法制导翻译
基本都是概念性的

## 属性文法
在乔姆斯基文法的基础上加一点东西

配置若干相关属性，例如：值、类型、地址等

对文法的**每个产生式**配备一组属性计算规则，称为**语义规则**
描述形式为$b:=f(c_1, c_2, ..., c_k)$，其中$b, c_1, c_2, ..., c_k$为文法符号的属性，$f$是一个函数

**每个文法符号**联系于一组属性，且对每个产生式都给出其**语义规则**的文法称为**属性文法**

## 属性和语义规则
- 属性代表与文法符号相关信息，如类型、值、代码序列、符号表内容等
- 属性可以计算和传递

对于每个产生式$A \rightarrow \alpha$都有一组与之相关联的语义规则，每条规则的形式为$$b:=f(c_1, c_2, ..., c_k)$$
两种属性
- 爸爸的依赖于孩子，由下而上传递信息 综合属性，因此需要知道A能定义为什么才可能知道A的**综合属性**/$b$是$A$的一个属性，并且$c_1, c_2, ..., c_k$是产生式**右边**文法符号的属性
- 反之由上而下或横着传递信息 **继承属性** / $b$是产生式右边某个文法符号$X$的一个属性，并且$c_1, c_2, ..., c_k$是**$A$或产生式右边任何文法符号的属性**

## 记号表示
对于某个文法符号$X \in V_T \cup V_N$，用$X.type, X.cat, X.val$(类型、种别、值或地址)等表示它的**属性**
用**下标**区分同一产生式中**相同符号的多次出现**

## S-属性文法
都是综合属性(都是孩子的属性决定父属性)的称为S-属性，适合LR分析法，自下而上，边分析边完成语义动作

## L-属性文法
都是综合属性，或者包含**有条件的继承属性**，L属性文法，适合LL(1)。如果用LR分析法，就需要非常艰辛地设计语义规则

对于产生式$A \rightarrow X_1...X_{j-1}X_j...X_n$的每条语义规则计算的属性是$A$的综合属性；或者$X_j$的继承属性，但它仅依赖
- 该产生式中$X_j$**左边的符号$X_1, X_2, ..., X_{j-1}$的属性**
- $A$的继承属性

注意L-属性文法包含了S-属性文法

希望只读一遍就可以词法分析、语法分析等等，完成中间代码生成的工作

## summary
- 终结符只有综合属性，由词法分析器提供
- 非终结符既可有综合属性也可有继承属性，文法开始符号的所有继承属性作为属性计算前的初始值(开始符号的继承属性可以自行指定)
- 对出现在产生式右边的继承属性和出现在产生式左边的综合属性都必须提供一个计算规则。属性计算规则中只能使用相应产生式中的文法符号的属性
- 出现在产生式左边的继承属性和出现在产生式右边的综合属性不由所给的产生式的属性计算规则进行计算，它们由其它产生式的属性规则计算或者由属性计算器的参数提供
- 语义规则所描述的工作可以包括属性计算、符号表操作、静态语义检查、代码生成等等。

# 语法制导翻译
基于属性文法的处理过程: 输入串 $\rightarrow$ 语法树 $\rightarrow$ 依赖图 $\rightarrow$ 语义规则计算次序

由源程序的语法结构所驱动的处理办法就是**语法制导翻译法**
- 依赖图
- 树遍历
- **一遍扫描**
  - 语法分析的同时计算属性值

语法制导翻译
- 直观上说就是为每个产生式配上一个翻译子程序（称语义动作或语义子程序），并且在语法分析的同时执行它。
- 语义动作一方面规定了产生式产生的符号串的意义，另一方面又按照这种意义规定了生成中间代码应做的基本动作。
- 定义：在语法分析过程中，当一个产生式获得匹配（自上而下分析）和用于归约（自下而上分析）时，此产生式对应的语义子程序进入工作，完成既定翻译任务，产生中间代码

## 作用
- 产生中间代码
- 产生目标指令
- 对输入串进行解释执行

## 练习
R → N.N { R.value = N1.value + N2.value / 10 }
N → d { N.value = d.lexval }
N → N1 d { N.value = N1.value * 10 + d.lexval }

在属性文法中，每个非终结符都有相关的属性。这里，我们为每个产生式使用了一个"value"属性来存储计算结果。

现在，让我们对给定的实数23.05画出属性树：

```
      R (value = 23.05)
     / \
    /   \
   /     \
  N      N (value = 0.05)
  |       |
  2  <-- d.lexval
 N (value = 2)
  |
 3   <-- d.lexval
```

根节点是非终结符R，其值为23.05。它的两个子节点是两个非终结符N，它们的值分别为2和0.05。叶节点标记了对应的终结符d的值。
